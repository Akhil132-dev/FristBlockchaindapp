<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="description" content="The HTML5 Herald" />
    <meta name="author" content="SitePoint" />

    <!-- <link rel="stylesheet" href="css/styles.css?v=1.0"> -->
    <title>Zombies</title>
  </head>
  <body>
    <input id="nameInput" type="text" placeholder="Enter your Zombies name" />
    <button id="ourButton">submit</button>
    <div id="detiles">
      <button id="feedzombie">Feedzombie</button>
    </div>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.min.js"></script>
    <script>
      // Checking if Web3 has been injected by the browser (Mist/MetaMask)
      // Modern DApp Browsers

      window.addEventListener("load", function () {
        if (typeof web3 !== "undefined") {
          if (web3.currentProvider.isMetaMask === true) {
            console.log("MetaMask is active");
            web3js = new Web3(web3.currentProvider);
            startApp();
          } else {
            alert("MetaMask is not active");
          }
        } else {
          alert("Use Mist/MetaMask's provider");
        }
      });
      function startApp() {
        let abi = [
          {
            constant: false,
            inputs: [
              {
                internalType: "string",
                name: "_name",
                type: "string",
              },
            ],
            name: "createRandomZombie",
            outputs: [],
            payable: false,
            stateMutability: "nonpayable",
            type: "function",
          },
          {
            constant: false,
            inputs: [
              {
                internalType: "uint256",
                name: "_zombieId",
                type: "uint256",
              },
              {
                internalType: "uint256",
                name: "_targetDna",
                type: "uint256",
              },
            ],
            name: "feedAndMultiply",
            outputs: [],
            payable: false,
            stateMutability: "nonpayable",
            type: "function",
          },
          {
            constant: false,
            inputs: [
              {
                internalType: "uint256",
                name: "_zombieId",
                type: "uint256",
              },
              {
                internalType: "uint256",
                name: "_kittyId",
                type: "uint256",
              },
            ],
            name: "feedOnKitty",
            outputs: [],
            payable: false,
            stateMutability: "nonpayable",
            type: "function",
          },
          {
            anonymous: false,
            inputs: [
              {
                indexed: false,
                internalType: "uint256",
                name: "zombieId",
                type: "uint256",
              },
              {
                indexed: false,
                internalType: "string",
                name: "name",
                type: "string",
              },
              {
                indexed: false,
                internalType: "uint256",
                name: "dna",
                type: "uint256",
              },
            ],
            name: "NewZombie",
            type: "event",
          },
          {
            constant: true,
            inputs: [
              {
                internalType: "uint256",
                name: "",
                type: "uint256",
              },
            ],
            name: "zombies",
            outputs: [
              {
                internalType: "string",
                name: "name",
                type: "string",
              },
              {
                internalType: "uint256",
                name: "dna",
                type: "uint256",
              },
            ],
            payable: false,
            stateMutability: "view",
            type: "function",
          },
          {
            constant: true,
            inputs: [
              {
                internalType: "uint256",
                name: "",
                type: "uint256",
              },
            ],
            name: "zombieToOwner",
            outputs: [
              {
                internalType: "address",
                name: "",
                type: "address",
              },
            ],
            payable: false,
            stateMutability: "view",
            type: "function",
          },
        ];

        const button = document.getElementById("ourButton");

        const input = document.getElementById("nameInput");
        const button2 = document.getElementById("feedzombie");
        /*
abi generated by the complier
*/
        const contractAddress = "0x95e2f846b95E2Db32B74Db3697ef4c9534E020d1";
        console.log(web3js.eth);
        const ZombiefactoryContract = new web3js.eth.Contract(
          abi,
          contractAddress
        );

        // // `ZombieFactory` has access to our contract's public functions and events
        console.log("il", ZombiefactoryContract);

        button.addEventListener("click", () => {
          event.preventDefault();
          var name = input.value;
          // Call our contract's `createRandomzombie`function
          web3js.eth.getAccounts().then(function (accounts) {
            ZombiefactoryContract.methods
              .createRandomZombie(name)
              .send({ from: accounts[0] });
          });

          console.log("functioncalled");
        });
        var zombieId = 1;
        var kittyId = 1;
        button2.addEventListener("click", () => {
          event.preventDefault();
          var name = input.value;
          // Call our contract's `createRandomzombie`function
          web3js.eth.getAccounts().then(function (accounts) {
            ZombiefactoryContract.methods
              .feedOnKitty(zombieId, kittyId)
              .send({ from: accounts[0] });
          });
        });
        // console.log("il", ZombiefactoryContract.events.NewZombie());
        console.log(ZombiefactoryContract);
        ZombiefactoryContract.events
          .NewZombie()
          .on("data", function (event) {
            let zombie = event.returnValues;
            // We can access this event's 3 return values on the `event.returnValues` object:
            console.log("A new zombie was born!", zombie);
          })
          .on("error", console.error);
      }
    </script>
  </body>
</html>
